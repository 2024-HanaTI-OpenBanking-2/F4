<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" th:href="@{/css/home.css}"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"/>
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
  <title>F4-afterlogin</title>
</head>

<body>
<div>
  <div class="element">
    <div class="div">
      <div class="overlap">
        <!-- Dynamic username display -->
        <div class="text-wrapper" th:text="'F4'">Bank</div>

        <!-- Swiper -->
        <div class="swiper mySwiper">
          <div class="swiper-wrapper">
            <div class="swiper-slide"><img src="img/slide1.jpg" alt="Slide 1"/></div>
            <div class="swiper-slide"><img src="img/slide2.jpg" alt="Slide 2"/></div>
            <div class="swiper-slide"><img src="img/slide3.jpg" alt="Slide 3"/></div>
          </div>
          <!-- Add Pagination -->
          <div class="swiper-pagination"></div>
          <!-- Add Navigation -->
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>
      <div class="overlap-3">
        <div class="text-wrapper-3" th:text="'F4'">my bank</div>
        <div class="rectangle"></div>
      </div>

      <img class="line" src="img/line-1.svg"/>
      <div class="overlap-4">
        <a href="/transfer" th:href="@{/transfer}">
          <div class="account-transfer">계좌 이체</div>
        </a>
        <div class="overlap-group-wrapper">
          <div class="text-wrapper-4" th:text="${customer.name} + '님 안녕하세요'">Customer greeting</div>

          <div class="div-wrapper">
            <!-- Logout link with Thymeleaf -->
            <div class="text-wrapper-9">
              <a class="logout" th:href="@{/logout}" th:text="'로그아웃'">Logout</a>
            </div>
          </div>
        </div>
      </div>
      <p class="text-text-text-text">
        text text text text text text text text
      </p>
      <div class="overlap-5">
        <form onsubmit="sendAPIRequest(); return false;">
          <button type="submit" id="authenticateLink" class="apiButton">오픈 뱅킹 이용하기</button>
        </form>
        <a th:href="@{/request-auth-code}"> 토큰발급</a>
        <a th:href="@{/accountinfo}">계좌통합조회</a>
      </div>
      <img class="align-justify" src="img/align-justify.svg"/>
      <span class="search material-symbols-outlined">search</span>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
<script src="/js/useopenbankingbutton.js"></script>
<script>
  var mySwiper = new Swiper('.mySwiper', {
    loop: true,
    pagination: {
      el: '.swiper-pagination',
    },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    mousewheel: true,
    keyboard: true,
  });
</script>
<script>
  document.getElementById('authenticateLink').addEventListener('click', function (e) {
    e.preventDefault();
    var width = 700;
    var height = 700;
    var left = (screen.width / 2) - (width / 2);
    var top = (screen.height / 2) - (height / 2);
    var windowFeatures = `width=${width},height=${height},top=${top},left=${left},resizable=yes`;
    var popup = window.open('/show-send-form', 'Authenticate', windowFeatures);

    // 팝업 창이 닫혔는지 확인하는 함수
    var checkPopupClosed = setInterval(function() {
      if (popup && popup.closed) {
        clearInterval(checkPopupClosed);
        // 팝업이 닫혔을 때 처리할 작업을 여기에 작성
        // window.location.href = '/auth-code-page.html';
      }
    }, 500);
  });

  window.addEventListener("message", function (event) {
    if (event.data === "인증성공") {
      // 필요한 화면 업데이트 로직
      // location.reload();  // 예: 페이지 새로고침
      window.location.href = '/auth-code-page';
      // alert("인증이 완료되었습니다.");
      console.log("인증이 완료되었습니다.");
    }
  }, false);
</script>
</body>
</html>
